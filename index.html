<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>32678939c85d43f1bd4250bf81ab2c08</title>
    <style>
      html {
        line-height: 1.5;
        font-family: Georgia, serif;
        font-size: 20px;
        color: #1a1a1a;
        background-color: #fdfdfd;
      }
      body {
        margin: 0 auto;
        max-width: 36em;
        padding-left: 50px;
        padding-right: 50px;
        padding-top: 50px;
        padding-bottom: 50px;
        hyphens: auto;
        overflow-wrap: break-word;
        text-rendering: optimizeLegibility;
        font-kerning: normal;
      }
      @media (max-width: 600px) {
        body {
          font-size: 0.9em;
          padding: 1em;
        }
        h1 {
          font-size: 1.8em;
        }
      }
      @media print {
        body {
          background-color: transparent;
          color: black;
          font-size: 12pt;
        }
        p,
        h2,
        h3 {
          orphans: 3;
          widows: 3;
        }
        h2,
        h3,
        h4 {
          page-break-after: avoid;
        }
      }
      p {
        margin: 1em 0;
      }
      a {
        color: #1a1a1a;
      }
      a:visited {
        color: #1a1a1a;
      }
      img {
        max-width: 100%;
      }
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin-top: 1.4em;
      }
      h5,
      h6 {
        font-size: 1em;
        font-style: italic;
      }
      h6 {
        font-weight: normal;
      }
      ol,
      ul {
        padding-left: 1.7em;
        margin-top: 1em;
      }
      li > ol,
      li > ul {
        margin-top: 0;
      }
      blockquote {
        margin: 1em 0 1em 1.7em;
        padding-left: 1em;
        border-left: 2px solid #e6e6e6;
        color: #606060;
      }
      code {
        font-family: Menlo, Monaco, "Lucida Console", Consolas, monospace;
        font-size: 85%;
        margin: 0;
      }
      pre {
        margin: 1em 0;
        overflow: auto;
      }
      pre code {
        padding: 0;
        overflow: visible;
        overflow-wrap: normal;
      }
      .sourceCode {
        background-color: transparent;
        overflow: visible;
      }
      hr {
        background-color: #1a1a1a;
        border: none;
        height: 1px;
        margin: 1em 0;
      }
      table {
        margin: 1em 0;
        border-collapse: collapse;
        width: 100%;
        overflow-x: auto;
        display: block;
        font-variant-numeric: lining-nums tabular-nums;
      }
      table caption {
        margin-bottom: 0.75em;
      }
      tbody {
        margin-top: 0.5em;
        border-top: 1px solid #1a1a1a;
        border-bottom: 1px solid #1a1a1a;
      }
      th {
        border-top: 1px solid #1a1a1a;
        padding: 0.25em 0.5em 0.25em 0.5em;
      }
      td {
        padding: 0.125em 0.5em 0.25em 0.5em;
      }
      header {
        margin-bottom: 4em;
        text-align: center;
      }
      #TOC li {
        list-style: none;
      }
      #TOC ul {
        padding-left: 1.3em;
      }
      #TOC > ul {
        padding-left: 0;
      }
      #TOC a:not(:hover) {
        text-decoration: none;
      }
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      div.columns {
        display: flex;
        gap: min(4vw, 1.5em);
      }
      div.column {
        flex: auto;
        overflow-x: auto;
      }
      div.hanging-indent {
        margin-left: 1.5em;
        text-indent: -1.5em;
      }
      ul.task-list {
        list-style: none;
      }
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1.6em;
        vertical-align: middle;
      }
      pre > code.sourceCode {
        white-space: pre;
        position: relative;
      }
      pre > code.sourceCode > span {
        display: inline-block;
        line-height: 1.25;
      }
      pre > code.sourceCode > span:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode > span {
        color: inherit;
        text-decoration: inherit;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        pre > code.sourceCode {
          white-space: pre-wrap;
        }
        pre > code.sourceCode > span {
          text-indent: -5em;
          padding-left: 5em;
        }
      }
      pre.numberSource code {
        counter-reset: source-line 0;
      }
      pre.numberSource code > span {
        position: relative;
        left: -4em;
        counter-increment: source-line;
      }
      pre.numberSource code > span > a:first-child::before {
        content: counter(source-line);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        pre > code.sourceCode > span > a:first-child::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
        color: #008000;
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
        color: #008000;
        font-weight: bold;
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
      .display.math {
        display: block;
        text-align: center;
        margin: 0.5rem auto;
      }
    </style>
    <!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <section
      id="spring-2025-data-science-project-berlin-marathon-analysis"
      class="cell markdown"
    >
      <h1>Spring 2025 Data Science Project: Berlin Marathon Analysis</h1>
      <h2 id="team-members-and-contributions">
        Team Members and Contributions
      </h2>
      <p>Ben Talesnik &amp; Zach Hiner</p>
      <h3 id="contributions">Contributions:</h3>
      <p>
        For each team member, list their contributions across the following
        categories:
      </p>
      <ul>
        <li>
          A: Project idea
          <ul>
            <li>
              We both contributed to the project idea due to our interest in the
              sport of running. We are both fanscinated in marathon running and
              wanted to analyze the data to see how the sport has evolved over
              time.
            </li>
          </ul>
        </li>
        <li>
          B: Dataset Curation and Preprocessing
          <ul>
            <li>
              Ben was responsible for curating the dataset and preprocessing the
              data. He also created the initial data exploration and summary
              statistics.
            </li>
          </ul>
        </li>
        <li>
          C: Data Exploration and Summary Statistics
          <ul>
            <li>
              Zach was responsible for the gender performance difference,
              year-over-year performance trends, and a pace analysis. He also
              created the visualization and result analysis.
            </li>
          </ul>
        </li>
        <li>
          D: ML Algorithm Design/Development
          <ul>
            <li>
              Ben was responsible for the linear regression model and the
              forecast analysis. He also created the 5th percentile finish time
              analysis.
            </li>
          </ul>
        </li>
        <li>
          E: ML Algorithm Training and Test Data Analysis
          <ul>
            <li>
              Zach helped code the linear regression model and the forecast
              analysis. He was able to determine the best fit line for the data
              and the forecast for the future.
            </li>
          </ul>
        </li>
        <li>
          F: Visualization, Result Analysis, Conclusion
          <ul>
            <li>
              Both of us worked to create the visualization and result analysis.
              We both worked to create the conclusion and write the tutorial
              report.
            </li>
          </ul>
        </li>
        <li>
          G: Final Tutorial Report Creation
          <ul>
            <li>
              We both met to write the tutorial report and finalize the project.
            </li>
          </ul>
        </li>
        <li>
          H: Additional
          <ul>
            <li>
              We also both worked together to ensure all of our progress was
              stored in the GitHub repository.
            </li>
          </ul>
        </li>
      </ul>
      <h2 id="1-introduction">1. Introduction</h2>
      <p>
        This project analyzes Berlin Marathon results from 1999 to 2019, one of
        the world's most prestigious marathon events. Through this analysis, we
        aim to:
      </p>
      <ol>
        <li>
          Has the average time to finish the marathon decreased over time?
        </li>
        <li>
          How has the average time to finish the marathon changed over time for
          different genders?
        </li>
        <li>
          How has the average time to finish the marathon changed over time for
          different countries?
        </li>
      </ol>
      <p>
        Understanding these patterns is important because it can help us
        understand how the sport of marathon running has evolved over time. It
        demonstrates the impact of technology, training, and other factors on
        marathon performance. With the introduction of carbon plated shoes, new
        fitness tests, and other factors, it is important to understand how
        these changes have affected the sport.
      </p>
      <h2 id="2-data-curation-and-preprocessing">
        2. Data Curation and Preprocessing
      </h2>
      <h3 id="data-source">Data Source</h3>
      <p>Marathon finisher results from the Berlin marathon between 1999 and</p>
      <ol>
        <li>
          Miller, Andrew, Marathon Results, (2021), GitHub Repository,<br />
          <a
            href="https://github.com/AndrewMillerOnline/marathon-results"
            class="uri"
            >https://github.com/AndrewMillerOnline/marathon-results</a
          >
        </li>
      </ol>
      <h3 id="initial-data-overview">Initial Data Overview</h3>
      <p>
        The dataset contains information about the runners, their times, and
        other details from a few of the world's most prestigious marathons. We
        have chosen to focus on the Berlin Marathon due to the completeness of
        the dataset. The dataset includes information including:
      </p>
      <ul>
        <li>Place</li>
        <li>Name</li>
        <li>Nationality</li>
        <li>Club</li>
        <li>Time</li>
        <li>Gender</li>
        <li>Splits for 5k, 10k, 15k, 20k, 25k, 30k, 35k, 40k</li>
        <li>Year</li>
      </ul>
      <p>
        This dataset is useful for our analysis because it contains a large
        amount of information about the runners, including their times, gender,
        nationality, and club.
      </p>
    </section>
    <div class="cell code" data-execution_count="212">
      <div class="sourceCode" id="cb1">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing necessary libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> RandomizedSearchCV</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set style for all visualizations</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&#39;husl&#39;</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&quot;seaborn-v0_8&quot;</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure pandas display options</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">&#39;display.max_columns&#39;</span>, <span class="va">None</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">&#39;display.max_rows&#39;</span>, <span class="dv">10</span>)</span></code></pre>
      </div>
    </div>
    <section id="data-loading-and-preprocessing" class="cell markdown">
      <h3>Data Loading and Preprocessing</h3>
      <p>
        The dataset overall is very clean and does not require much
        preprocessing. With the initial import, we're focusing on ensuring the
        current years are imported (1999-2019). With each year added to the
        dataframe, a year column is created to keep track of the year of the
        marathon.
      </p>
    </section>
    <div class="cell code" data-execution_count="213">
      <div class="sourceCode" id="cb2">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>START_YEAR <span class="op">=</span> <span class="dv">1999</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>END_YEAR <span class="op">=</span> <span class="dv">2019</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of dataframes</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> []</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> <span class="bu">range</span>(START_YEAR, END_YEAR <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(<span class="ss">f&#39;./data/results-</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.csv&#39;</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">&#39;year&#39;</span>] <span class="op">=</span> year</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    dfs.append(df)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate all dataframes</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pd.concat(dfs, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with missing values, even though we know there are none</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> results.dropna()</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>display(results)</span></code></pre>
      </div>
      <div class="output display_data">
        <div>
          <style scoped>
            .dataframe tbody tr th:only-of-type {
              vertical-align: middle;
            }

            .dataframe tbody tr th {
              vertical-align: top;
            }

            .dataframe thead th {
              text-align: right;
            }
          </style>
          <table border="1" class="dataframe">
            <thead>
              <tr style="text-align: right">
                <th></th>
                <th>place_overall</th>
                <th>first_name</th>
                <th>last_name</th>
                <th>nationality</th>
                <th>club</th>
                <th>time_full</th>
                <th>gender</th>
                <th>split_5k</th>
                <th>split_10k</th>
                <th>split_15k</th>
                <th>split_20k</th>
                <th>time_half</th>
                <th>split_25k</th>
                <th>split_30k</th>
                <th>split_35k</th>
                <th>split_40k</th>
                <th>Race</th>
                <th>year</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>0</th>
                <td>1</td>
                <td>Josephat</td>
                <td>Kiprono</td>
                <td>KEN</td>
                <td>Kenia</td>
                <td>02:06:44</td>
                <td>M</td>
                <td>00:15:09</td>
                <td>00:30:21</td>
                <td>00:45:25</td>
                <td>01:00:34</td>
                <td>01:03:54</td>
                <td>01:14:54</td>
                <td>01:30:10</td>
                <td>01:45:05</td>
                <td>02:00:08</td>
                <td>Berlin</td>
                <td>1999</td>
              </tr>
              <tr>
                <th>1</th>
                <td>2</td>
                <td>Takayuki</td>
                <td>Inubushi</td>
                <td>JPN</td>
                <td>Japan</td>
                <td>02:06:57</td>
                <td>M</td>
                <td>00:15:09</td>
                <td>00:30:21</td>
                <td>00:45:27</td>
                <td>01:00:36</td>
                <td>01:03:54</td>
                <td>01:14:56</td>
                <td>01:30:18</td>
                <td>01:45:21</td>
                <td>02:00:18</td>
                <td>Berlin</td>
                <td>1999</td>
              </tr>
              <tr>
                <th>2</th>
                <td>3</td>
                <td>Samson</td>
                <td>Kandie</td>
                <td>KEN</td>
                <td>Kenia</td>
                <td>02:08:31</td>
                <td>M</td>
                <td>00:15:10</td>
                <td>00:30:21</td>
                <td>00:45:27</td>
                <td>01:00:35</td>
                <td>01:03:54</td>
                <td>01:14:55</td>
                <td>01:30:18</td>
                <td>01:45:59</td>
                <td>02:01:41</td>
                <td>Berlin</td>
                <td>1999</td>
              </tr>
              <tr>
                <th>3</th>
                <td>4</td>
                <td>Hicham</td>
                <td>Chatt</td>
                <td>MAR</td>
                <td>Marokko</td>
                <td>02:09:56</td>
                <td>M</td>
                <td>00:15:11</td>
                <td>00:30:23</td>
                <td>00:45:27</td>
                <td>01:00:36</td>
                <td>01:03:55</td>
                <td>01:14:56</td>
                <td>01:30:24</td>
                <td>01:46:14</td>
                <td>02:02:52</td>
                <td>Berlin</td>
                <td>1999</td>
              </tr>
              <tr>
                <th>4</th>
                <td>5</td>
                <td>Henry</td>
                <td>Cherono</td>
                <td>KEN</td>
                <td>Kenia</td>
                <td>02:10:37</td>
                <td>M</td>
                <td>00:15:10</td>
                <td>00:30:21</td>
                <td>00:00:00</td>
                <td>01:00:35</td>
                <td>01:03:55</td>
                <td>01:14:55</td>
                <td>01:30:18</td>
                <td>01:46:14</td>
                <td>02:02:58</td>
                <td>Berlin</td>
                <td>1999</td>
              </tr>
              <tr>
                <th>...</th>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
              </tr>
              <tr>
                <th>678702</th>
                <td>30739</td>
                <td>Wolfgang</td>
                <td>Biedermann</td>
                <td>GER</td>
                <td>SC . LT SAD ,Spiridon</td>
                <td>07:12:30</td>
                <td>M</td>
                <td>00:39:11</td>
                <td>01:26:52</td>
                <td>02:15:21</td>
                <td>03:09:25</td>
                <td>03:22:13</td>
                <td>04:06:45</td>
                <td>05:04:06</td>
                <td>05:56:57</td>
                <td>06:49:33</td>
                <td>Berlin</td>
                <td>2019</td>
              </tr>
              <tr>
                <th>678705</th>
                <td>13243</td>
                <td>Elvira</td>
                <td>Ernst</td>
                <td>GER</td>
                <td>261 Fearless</td>
                <td>07:14:44</td>
                <td>W</td>
                <td>00:46:10</td>
                <td>01:34:15</td>
                <td>02:23:21</td>
                <td>03:12:21</td>
                <td>03:22:44</td>
                <td>04:02:34</td>
                <td>04:56:52</td>
                <td>05:50:44</td>
                <td>06:48:44</td>
                <td>Berlin</td>
                <td>2019</td>
              </tr>
              <tr>
                <th>678706</th>
                <td>30740</td>
                <td>Gert</td>
                <td>Kleinschmidt</td>
                <td>GER</td>
                <td>Dessauer SV 97</td>
                <td>07:15:28</td>
                <td>M</td>
                <td>00:49:05</td>
                <td>01:42:38</td>
                <td>02:38:02</td>
                <td>03:27:30</td>
                <td>03:37:40</td>
                <td>04:16:57</td>
                <td>05:09:49</td>
                <td>06:01:58</td>
                <td>06:54:25</td>
                <td>Berlin</td>
                <td>2019</td>
              </tr>
              <tr>
                <th>678709</th>
                <td>30741</td>
                <td>Oscar</td>
                <td>Martinez</td>
                <td>USA</td>
                <td>BRIDERUNNERS</td>
                <td>07:19:28</td>
                <td>M</td>
                <td>00:37:26</td>
                <td>01:18:14</td>
                <td>02:05:06</td>
                <td>02:59:24</td>
                <td>03:10:51</td>
                <td>03:56:15</td>
                <td>04:58:07</td>
                <td>06:01:29</td>
                <td>06:56:38</td>
                <td>Berlin</td>
                <td>2019</td>
              </tr>
              <tr>
                <th>678710</th>
                <td>30742</td>
                <td>Dietmar</td>
                <td>John</td>
                <td>GER</td>
                <td>Bayerische Laufzeitung-Der Che</td>
                <td>07:26:09</td>
                <td>M</td>
                <td>00:42:11</td>
                <td>01:29:17</td>
                <td>02:21:20</td>
                <td>03:13:21</td>
                <td>03:24:52</td>
                <td>04:09:27</td>
                <td>05:07:35</td>
                <td>06:04:09</td>
                <td>07:01:16</td>
                <td>Berlin</td>
                <td>2019</td>
              </tr>
            </tbody>
          </table>
          <p>290390 rows × 18 columns</p>
        </div>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        Now we need to convert the time column to a more usable format. We need
        to go through each of the time columns and convert them to a datetime
        object. Each time is converted to minutes for easier analysis.
      </p>
    </div>
    <div class="cell code" data-execution_count="214">
      <div class="sourceCode" id="cb3">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert time columns to datetime</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>time_columns <span class="op">=</span> [<span class="st">&#39;time_full&#39;</span>, <span class="st">&#39;split_5k&#39;</span>, <span class="st">&#39;split_10k&#39;</span>, <span class="st">&#39;split_15k&#39;</span>, <span class="st">&#39;split_20k&#39;</span>, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;time_half&#39;</span>, <span class="st">&#39;split_25k&#39;</span>, <span class="st">&#39;split_30k&#39;</span>, <span class="st">&#39;split_35k&#39;</span>, <span class="st">&#39;split_40k&#39;</span>]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> time_columns:</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> pd.to_datetime(results[col], <span class="bu">format</span><span class="op">=</span><span class="st">&#39;%H:%M:%S&#39;</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    results[<span class="ss">f&#39;</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_minutes&#39;</span>] <span class="op">=</span> (</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        dt.dt.hour <span class="op">*</span> <span class="dv">60</span> <span class="op">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        dt.dt.minute <span class="op">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        dt.dt.second <span class="op">/</span> <span class="dv">60</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove any rows where the time is under 100 minutes</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> results[results[<span class="st">&#39;time_full_minutes&#39;</span>] <span class="op">&gt;=</span> <span class="dv">100</span>]</span></code></pre>
      </div>
    </div>
    <section id="3-exploratory-data-analysis" class="cell markdown">
      <h2>3. Exploratory Data Analysis</h2>
      <p>
        In this section, we'll explore key characteristics of our dataset
        through summary statistics and visualizations.
      </p>
    </section>
    <section id="summary-statistics" class="cell markdown">
      <h3>Summary Statistics</h3>
    </section>
    <div class="cell code" data-execution_count="215">
      <div class="sourceCode" id="cb4">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic information about the dataset</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Dataset Shape:&quot;</span>, results.shape)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Columns:&quot;</span>, results.columns.tolist())</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Data Types:&quot;</span>, results.dtypes)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Missing Values:&quot;</span>, results.isnull().<span class="bu">sum</span>())</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Mean:&quot;</span>, results[<span class="st">&#39;time_full_minutes&#39;</span>].mean())</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Median:&quot;</span>, results[<span class="st">&#39;time_full_minutes&#39;</span>].median())</span></code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Dataset Shape:&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>(290389, 28)</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Columns:&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>[&#39;place_overall&#39;,
 &#39;first_name&#39;,
 &#39;last_name&#39;,
 &#39;nationality&#39;,
 &#39;club&#39;,
 &#39;time_full&#39;,
 &#39;gender&#39;,
 &#39;split_5k&#39;,
 &#39;split_10k&#39;,
 &#39;split_15k&#39;,
 &#39;split_20k&#39;,
 &#39;time_half&#39;,
 &#39;split_25k&#39;,
 &#39;split_30k&#39;,
 &#39;split_35k&#39;,
 &#39;split_40k&#39;,
 &#39;Race&#39;,
 &#39;year&#39;,
 &#39;time_full_minutes&#39;,
 &#39;split_5k_minutes&#39;,
 &#39;split_10k_minutes&#39;,
 &#39;split_15k_minutes&#39;,
 &#39;split_20k_minutes&#39;,
 &#39;time_half_minutes&#39;,
 &#39;split_25k_minutes&#39;,
 &#39;split_30k_minutes&#39;,
 &#39;split_35k_minutes&#39;,
 &#39;split_40k_minutes&#39;]</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Data Types:&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>place_overall          int64
first_name            object
last_name             object
nationality           object
club                  object
                      ...   
time_half_minutes    float64
split_25k_minutes    float64
split_30k_minutes    float64
split_35k_minutes    float64
split_40k_minutes    float64
Length: 28, dtype: object</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Missing Values:&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>place_overall        0
first_name           0
last_name            0
nationality          0
club                 0
                    ..
time_half_minutes    0
split_25k_minutes    0
split_30k_minutes    0
split_35k_minutes    0
split_40k_minutes    0
Length: 28, dtype: int64</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Mean:&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>np.float64(241.469336476244)</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Median:&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>np.float64(237.23333333333332)</code></pre>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        As we can see, the dataset is very clean and does not require much
        preprocessing due to the fact that there are no missing values. You can
        also see the columns that are time columns and have been converted to
        minutes while preserving the original time format. The mean and median
        are very close, which indicates that the dataset is not skewed. The
        average time to finish the marathon is 241.47 minutes (4 hours and 1
        minute), with a median of 237.23 minutes (3 hours and 57 minutes).
      </p>
      <p>
        We have chosen to look at a few different aspects of the dataset. We
        will be looking at the distribution of finish times, the gender
        distribution, and the correlation between splits.
      </p>
      <p>
        With further statistical analysis, we will look at the gender
        performance difference, year-over-year performance trends, and a pace
        analysis.
      </p>
      <h3 id="distribution-of-finish-times">Distribution of Finish Times</h3>
    </div>
    <div class="cell code" data-execution_count="216">
      <div class="sourceCode" id="cb17">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>results, x<span class="op">=</span><span class="st">&#39;time_full_minutes&#39;</span>, bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Marathon Finish Times, Berlin (1999-2019)&#39;</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Finish Time (minutes)&#39;</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre>
      </div>
      <div class="output display_data">
        <p><img src="images/62eb3930f7d8cc9208083c61cda18a1044b4bd38.png" /></p>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        This distribution of Marathon Finish Times from the Berlin Marathon
        1999-2019 is right-skewed. It shows the mean of the distribution is
        around 4 hours. Elite runners finish quickly around 2 to 2.5 hours,
        creating a sharp peak at the left end. A smaller group takes 6+ hours
        due to exhaustion, injuries, or walking, forming the right tail.
      </p>
      <h3 id="distribution-of-genders">Distribution of Genders</h3>
    </div>
    <div class="cell code" data-execution_count="217">
      <div class="sourceCode" id="cb18">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>gender_counts <span class="op">=</span> results[<span class="st">&#39;gender&#39;</span>].value_counts()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>plt.pie(gender_counts, labels<span class="op">=</span>gender_counts.index, autopct<span class="op">=</span><span class="st">&#39;</span><span class="sc">%1.1f%%</span><span class="st">&#39;</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Gender Distribution in Marathon Participants, Berlin (1999-2019)&#39;</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre>
      </div>
      <div class="output display_data">
        <p><img src="images/8672a1dd15daeaaa7bffa18b41afe164cc5ab1e1.png" /></p>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        The gender distribution shows that there are way more male participants
        than female participants. Between 1999 and 2019, 79% of participants
        were male while only 21% were female.
      </p>
      <h3 id="correlation-between-splits">Correlation Between Splits</h3>
    </div>
    <div class="cell code" data-execution_count="218">
      <div class="sourceCode" id="cb19">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>split_columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> results.columns <span class="cf">if</span> <span class="st">&#39;minutes&#39;</span> <span class="kw">in</span> col]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> results[split_columns].corr()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>sns.heatmap(correlation_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">&#39;coolwarm&#39;</span>, center<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Correlation between Marathon Splits, Berlin (1999-2019)&#39;</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre>
      </div>
      <div class="output display_data">
        <p><img src="images/ddbee1ffef80649515efbbe963fd4db82faab0e7.png" /></p>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        The correlation heatmap shows a strong positive relationship between
        marathon split times, meaning runners who start fast tend to maintain
        their pace. Earlier splits are highly correlated, while later splits
        show slightly weaker correlations due to fatigue or pacing strategies.
        Elite runners likely have the strongest correlations, as they maintain
        consistent pacing. Overall, the heatmap highlights the predictable
        relationship between split times and overall marathon performance.
      </p>
      <h3 id="statistical-analysis-1-gender-performance-difference">
        Statistical Analysis 1: Gender Performance Difference
      </h3>
    </div>
    <div class="cell code" data-execution_count="219">
      <div class="sourceCode" id="cb20">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare finish times between genders</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>male_times <span class="op">=</span> results[results[<span class="st">&#39;gender&#39;</span>] <span class="op">==</span> <span class="st">&#39;M&#39;</span>][<span class="st">&#39;time_full_minutes&#39;</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>female_times <span class="op">=</span> results[results[<span class="st">&#39;gender&#39;</span>] <span class="op">==</span> <span class="st">&#39;W&#39;</span>][<span class="st">&#39;time_full_minutes&#39;</span>]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate basic statistics</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>male_mean <span class="op">=</span> male_times.mean()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>female_mean <span class="op">=</span> female_times.mean()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>male_median <span class="op">=</span> male_times.median()</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>female_median <span class="op">=</span> female_times.median()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform t-test to check if the difference is statistically significant</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>t_stat, pvalue <span class="op">=</span> stats.ttest_ind(male_times, female_times, equal_var<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the distributions with a histogram</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>sns.histplot(male_times, color<span class="op">=</span><span class="st">&#39;blue&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">&#39;Male&#39;</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>sns.histplot(female_times, color<span class="op">=</span><span class="st">&#39;red&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">&#39;Female&#39;</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>plt.axvline(male_mean, color<span class="op">=</span><span class="st">&#39;blue&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, label<span class="op">=</span><span class="ss">f&#39;Male Mean: </span><span class="sc">{</span>male_mean<span class="sc">:.2f}</span><span class="ss"> min&#39;</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>plt.axvline(female_mean, color<span class="op">=</span><span class="st">&#39;red&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, label<span class="op">=</span><span class="ss">f&#39;Female Mean: </span><span class="sc">{</span>female_mean<span class="sc">:.2f}</span><span class="ss"> min&#39;</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Marathon Finish Times by Gender, Berlin (1999-2019)&#39;</span>)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Finish Time (minutes)&#39;</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Statistical Analysis 1: Gender Performance Difference&quot;</span>)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;Male Mean: </span><span class="sc">{</span>male_mean<span class="sc">:.2f}</span><span class="ss"> minutes&quot;</span>)</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;Female Mean: </span><span class="sc">{</span>female_mean<span class="sc">:.2f}</span><span class="ss"> minutes&quot;</span>)</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;Difference: </span><span class="sc">{</span><span class="bu">abs</span>(male_mean <span class="op">-</span> female_mean)<span class="sc">:.2f}</span><span class="ss"> minutes&quot;</span>)</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;Male Median: </span><span class="sc">{</span>male_median<span class="sc">:.2f}</span><span class="ss"> minutes&quot;</span>)</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;Female Median: </span><span class="sc">{</span>female_median<span class="sc">:.2f}</span><span class="ss"> minutes&quot;</span>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;T-statistic: </span><span class="sc">{</span>t_stat<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;P-value: </span><span class="sc">{</span>pvalue<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span></code></pre>
      </div>
      <div class="output display_data">
        <p><img src="images/0414bd3fb324dcd1779568396e5c3f553a736daf.png" /></p>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Statistical Analysis 1: Gender Performance Difference&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Male Mean: 235.74 minutes&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Female Mean: 263.07 minutes&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Difference: 27.33 minutes&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Male Median: 232.02 minutes&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Female Median: 260.12 minutes&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;T-statistic: -146.8780&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;P-value: 0.0000&#39;</code></pre>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        This statistical analysis shows a significant gender performance
        difference in marathon times, with males finishing faster on average.
        The mean male finish time is 235.73 minutes, while the female mean is
        263.07 minutes, a 27.33 minute gap. The medians follow a similar
        pattern, reinforcing the trend. The extremely low p-value (0.0000) and
        large negative t-statistic (-146.88) indicate that this difference is
        highly statistically significant, meaning it is unlikely due to chance.
      </p>
      <h3 id="statistical-analysis-2-year-over-year-performance-trend">
        Statistical Analysis 2: Year-over-Year Performance Trend
      </h3>
    </div>
    <div class="cell code" data-execution_count="220">
      <div class="sourceCode" id="cb29">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>yearly_means <span class="op">=</span> results.groupby(<span class="st">&#39;year&#39;</span>)[<span class="st">&#39;time_full_minutes&#39;</span>].mean()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the trend with a line plot</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>yearly_means.plot(kind<span class="op">=</span><span class="st">&#39;line&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Average Marathon Finish Time by Year, Berlin (1999-2019)&#39;</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Year&#39;</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Average Finish Time (minutes)&#39;</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform linear regression</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>slope, intercept, r_value, p_value, std_err <span class="op">=</span> stats.linregress(yearly_means.index, yearly_means.values)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Statistical Analysis 2: Year-over-Year Performance Trend&quot;</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;Slope: </span><span class="sc">{</span>slope<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;R-squared: </span><span class="sc">{</span>r_value<span class="op">**</span><span class="dv">2</span><span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;P-value: </span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span></code></pre>
      </div>
      <div class="output display_data">
        <p><img src="images/6c59d7a8de0e956b3c594a5090c8014054c372c6.png" /></p>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Statistical Analysis 2: Year-over-Year Performance Trend&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Slope: 0.5230&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;R-squared: 0.3861&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;P-value: 0.0034&#39;</code></pre>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        This analysis examines the year-over-year trend in marathon finish times
        from 1999 to 2019. The positive slope (0.5229) suggests that average
        finish times have been gradually increasing, meaning runners are taking
        slightly longer to complete the marathon over time. We think this may be
        due to growth in marathon popularity as more casual runners and
        first-timers are participating, which could be pulling the average
        finish time higher. The R-squared value (0.3860) indicates a moderate
        correlation, meaning other factors also influence performance. The low
        p-value (0.0035) confirms that the trend is statistically significant
        and unlikely due to random chance. This suggests possible influences
        like changes in race conditions, participation demographics, or training
        methods over the years.
      </p>
      <h3 id="statistical-analysis-3-pace-analysis">
        Statistical Analysis 3: Pace Analysis
      </h3>
    </div>
    <div class="cell code" data-execution_count="221">
      <div class="sourceCode" id="cb34">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate pace (minutes per kilometer) for each split</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(split_columns)):</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    split_distance <span class="op">=</span> <span class="dv">5</span>  <span class="co"># Each split is 5km</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    results[<span class="ss">f&#39;pace_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">&#39;</span>] <span class="op">=</span> (results[split_columns[i]] <span class="op">-</span> results[split_columns[i<span class="op">-</span><span class="dv">1</span>]]) <span class="op">/</span> split_distance</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot of pace distribution across splits</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>pace_columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> results.columns <span class="cf">if</span> <span class="st">&#39;pace_&#39;</span> <span class="kw">in</span> col]</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>results[pace_columns].boxplot()</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Pace Distribution Across Marathon 5k Splits, Berlin (1999-2019)&#39;</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Split Number&#39;</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Pace (minutes per kilometer)&#39;</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform ANOVA test for pace differences across splits</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>pace_data <span class="op">=</span> [results[col].dropna() <span class="cf">for</span> col <span class="kw">in</span> pace_columns]</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>f_stat, p_value <span class="op">=</span> stats.f_oneway(<span class="op">*</span>pace_data)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Statistical Analysis 3: Pace Analysis&quot;</span>)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;F-statistic: </span><span class="sc">{</span>f_stat<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;P-value: </span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span></code></pre>
      </div>
      <div class="output display_data">
        <p><img src="images/ca1be0b7ef91fb7c37d0510b356f07c639f2503d.png" /></p>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Statistical Analysis 3: Pace Analysis&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;F-statistic: 6325841.9236&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;P-value: 0.0000&#39;</code></pre>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        This analysis explores the pace distribution across different 5k splits
        of the marathon from 1999 to 2019. By calculating the pace for each
        split, it provides insight into how runners' speeds change throughout
        the race. The box plot visually displays the distribution of paces
        across splits, showing that runners start faster and gradually slow
        down, especially as fatigue sets in. The ANOVA test results with an
        F-statistic of 6325419.9672 and a p-value of 0.0000 confirms that there
        are significant differences in pace across the splits. This suggests
        that runners generally run faster in the earlier splits and slow down in
        the later ones, which is typical in endurance races such as marathons
        due to factors like fatigue, pacing strategy, and race conditions. The
        very low p-value indicates that these differences in pace are
        statistically significant and not due to random chance.
      </p>
    </div>
    <section
      id="4--5-primary-analysis--visualization--results"
      class="cell markdown"
    >
      <h2>4. &amp; 5. Primary Analysis / Visualization &amp; Results</h2>
      <p>
        Based on the results of our exploration, we have chosen to use a linear
        regression model to predict how the average and 5th percentile finish
        times have changed over time. We believe that the 5th percentile finish
        time is a more accurate representation of the performance of the fastest
        runners, and therefore more useful for predicting the future.
      </p>
      <h3 id="linear-regression-model">Linear Regression Model</h3>
      <p>
        We will be using a linear regression model to predict the finish time of
        a runner based on their gender. A linear regression model is used in
        data science to predict the relationship between a dependent variable
        and one or more independent variables. In this case, the dependent
        variable is the finish time of a runner, and the independent variable is
        their gender.
      </p>
      <p>
        Let's first create a copy of the results dataframe to work with and
        standardize the gender column.
      </p>
    </section>
    <div class="cell code" data-execution_count="222">
      <div class="sourceCode" id="cb38">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> results.copy()</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;gender_code&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;gender&#39;</span>].<span class="bu">str</span>.strip().<span class="bu">str</span>.upper().<span class="bu">str</span>[<span class="dv">0</span>]</span></code></pre>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        Now, we will compute the average finish time per year for each gender.
      </p>
    </div>
    <div class="cell code" data-execution_count="223">
      <div class="sourceCode" id="cb39">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>avg_overall <span class="op">=</span> (</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">&#39;year&#39;</span>, as_index<span class="op">=</span><span class="va">False</span>)[<span class="st">&#39;time_full_minutes&#39;</span>]</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>avg_male <span class="op">=</span> (</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    df[df[<span class="st">&#39;gender_code&#39;</span>]<span class="op">==</span><span class="st">&#39;M&#39;</span>]</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">&#39;year&#39;</span>, as_index<span class="op">=</span><span class="va">False</span>)[<span class="st">&#39;time_full_minutes&#39;</span>]</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>avg_female <span class="op">=</span> (</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    df[df[<span class="st">&#39;gender_code&#39;</span>]<span class="op">==</span><span class="st">&#39;W&#39;</span>]</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">&#39;year&#39;</span>, as_index<span class="op">=</span><span class="va">False</span>)[<span class="st">&#39;time_full_minutes&#39;</span>]</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Average Finish Time per Year&quot;</span>, avg_overall)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Average Finish Time per Year for Males&quot;</span>, avg_male)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Average Finish Time per Year for Females&quot;</span>, avg_female)</span></code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Average Finish Time per Year&#39;</code></pre>
      </div>
      <div class="output display_data">
        <div>
          <style scoped>
            .dataframe tbody tr th:only-of-type {
              vertical-align: middle;
            }

            .dataframe tbody tr th {
              vertical-align: top;
            }

            .dataframe thead th {
              text-align: right;
            }
          </style>
          <table border="1" class="dataframe">
            <thead>
              <tr style="text-align: right">
                <th></th>
                <th>year</th>
                <th>time_full_minutes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>0</th>
                <td>1999</td>
                <td>230.064991</td>
              </tr>
              <tr>
                <th>1</th>
                <td>2000</td>
                <td>240.524645</td>
              </tr>
              <tr>
                <th>2</th>
                <td>2001</td>
                <td>233.795560</td>
              </tr>
              <tr>
                <th>3</th>
                <td>2002</td>
                <td>232.986569</td>
              </tr>
              <tr>
                <th>4</th>
                <td>2004</td>
                <td>235.138728</td>
              </tr>
              <tr>
                <th>...</th>
                <td>...</td>
                <td>...</td>
              </tr>
              <tr>
                <th>15</th>
                <td>2015</td>
                <td>240.178294</td>
              </tr>
              <tr>
                <th>16</th>
                <td>2016</td>
                <td>243.868154</td>
              </tr>
              <tr>
                <th>17</th>
                <td>2017</td>
                <td>244.849287</td>
              </tr>
              <tr>
                <th>18</th>
                <td>2018</td>
                <td>251.155402</td>
              </tr>
              <tr>
                <th>19</th>
                <td>2019</td>
                <td>243.218337</td>
              </tr>
            </tbody>
          </table>
          <p>20 rows × 2 columns</p>
        </div>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Average Finish Time per Year for Males&#39;</code></pre>
      </div>
      <div class="output display_data">
        <div>
          <style scoped>
            .dataframe tbody tr th:only-of-type {
              vertical-align: middle;
            }

            .dataframe tbody tr th {
              vertical-align: top;
            }

            .dataframe thead th {
              text-align: right;
            }
          </style>
          <table border="1" class="dataframe">
            <thead>
              <tr style="text-align: right">
                <th></th>
                <th>year</th>
                <th>time_full_minutes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>0</th>
                <td>1999</td>
                <td>226.954815</td>
              </tr>
              <tr>
                <th>1</th>
                <td>2000</td>
                <td>236.320251</td>
              </tr>
              <tr>
                <th>2</th>
                <td>2001</td>
                <td>229.583860</td>
              </tr>
              <tr>
                <th>3</th>
                <td>2002</td>
                <td>229.875422</td>
              </tr>
              <tr>
                <th>4</th>
                <td>2004</td>
                <td>230.189993</td>
              </tr>
              <tr>
                <th>...</th>
                <td>...</td>
                <td>...</td>
              </tr>
              <tr>
                <th>15</th>
                <td>2015</td>
                <td>234.356227</td>
              </tr>
              <tr>
                <th>16</th>
                <td>2016</td>
                <td>237.275377</td>
              </tr>
              <tr>
                <th>17</th>
                <td>2017</td>
                <td>237.856427</td>
              </tr>
              <tr>
                <th>18</th>
                <td>2018</td>
                <td>243.476952</td>
              </tr>
              <tr>
                <th>19</th>
                <td>2019</td>
                <td>234.839135</td>
              </tr>
            </tbody>
          </table>
          <p>20 rows × 2 columns</p>
        </div>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Average Finish Time per Year for Females&#39;</code></pre>
      </div>
      <div class="output display_data">
        <div>
          <style scoped>
            .dataframe tbody tr th:only-of-type {
              vertical-align: middle;
            }

            .dataframe tbody tr th {
              vertical-align: top;
            }

            .dataframe thead th {
              text-align: right;
            }
          </style>
          <table border="1" class="dataframe">
            <thead>
              <tr style="text-align: right">
                <th></th>
                <th>year</th>
                <th>time_full_minutes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>0</th>
                <td>1999</td>
                <td>248.983984</td>
              </tr>
              <tr>
                <th>1</th>
                <td>2000</td>
                <td>261.797333</td>
              </tr>
              <tr>
                <th>2</th>
                <td>2001</td>
                <td>256.749426</td>
              </tr>
              <tr>
                <th>3</th>
                <td>2002</td>
                <td>255.008837</td>
              </tr>
              <tr>
                <th>4</th>
                <td>2004</td>
                <td>256.924887</td>
              </tr>
              <tr>
                <th>...</th>
                <td>...</td>
                <td>...</td>
              </tr>
              <tr>
                <th>15</th>
                <td>2015</td>
                <td>260.288286</td>
              </tr>
              <tr>
                <th>16</th>
                <td>2016</td>
                <td>264.953039</td>
              </tr>
              <tr>
                <th>17</th>
                <td>2017</td>
                <td>264.489884</td>
              </tr>
              <tr>
                <th>18</th>
                <td>2018</td>
                <td>270.961225</td>
              </tr>
              <tr>
                <th>19</th>
                <td>2019</td>
                <td>265.641949</td>
              </tr>
            </tbody>
          </table>
          <p>20 rows × 2 columns</p>
        </div>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        Now, we will fit a linear regression model to the data. We will use the
        year as the independent variable and the average finish time as the
        dependent variable.
      </p>
    </div>
    <div class="cell code" data-execution_count="224">
      <div class="sourceCode" id="cb43">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear trend and forecast 2020–2050</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_and_forecast(df, start<span class="op">=</span><span class="dv">2020</span>, end<span class="op">=</span><span class="dv">2050</span>):</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.DataFrame({<span class="st">&#39;year&#39;</span>: [], <span class="st">&#39;pred&#39;</span>: []})</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> df[[<span class="st">&#39;year&#39;</span>]].values</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> df[<span class="st">&#39;time_full_minutes&#39;</span>].values</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> LinearRegression().fit(X, y)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    future_years <span class="op">=</span> np.arange(start, end <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> model.predict(future_years.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({<span class="st">&#39;year&#39;</span>: future_years, <span class="st">&#39;pred&#39;</span>: preds})</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>fc_overall <span class="op">=</span> fit_and_forecast(avg_overall)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>fc_male    <span class="op">=</span> fit_and_forecast(avg_male)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>fc_female  <span class="op">=</span> fit_and_forecast(avg_female)</span></code></pre>
      </div>
    </div>
    <div class="cell markdown">
      <p>Now that we have the forecasted values, we can plot them.</p>
    </div>
    <div class="cell code" data-execution_count="225">
      <div class="sourceCode" id="cb44">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot each series on its own figure</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>series <span class="op">=</span> [</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;Overall Average&#39;</span>, avg_overall, fc_overall),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;Male Average&#39;</span>,    avg_male,    fc_male),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;Female Average&#39;</span>,  avg_female,  fc_female)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> title, hist, fc <span class="kw">in</span> series:</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    plt.plot(hist[<span class="st">&#39;year&#39;</span>], hist[<span class="st">&#39;time_full_minutes&#39;</span>],</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>             marker<span class="op">=</span><span class="st">&#39;o&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;-&#39;</span>, label<span class="op">=</span><span class="st">&#39;Historical&#39;</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> fc.empty:</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>        plt.plot(fc[<span class="st">&#39;year&#39;</span>], fc[<span class="st">&#39;pred&#39;</span>],</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>                 marker<span class="op">=</span><span class="st">&#39;x&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, label<span class="op">=</span><span class="st">&#39;Forecast&#39;</span>)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f&quot;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss"> Finish Time&quot;</span>)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&quot;Year&quot;</span>)</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&quot;Average Finish Time (min)&quot;</span>)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre>
      </div>
      <div class="output display_data">
        <p><img src="images/cfff77cdb92a4814c360c4c17d936a7d38828686.png" /></p>
      </div>
      <div class="output display_data">
        <p><img src="images/dab62f53bdf75827d54d930e7e2ef3de1c911e35.png" /></p>
      </div>
      <div class="output display_data">
        <p><img src="images/418fa488c5d56459ad99c2fef4f306e997eb659c.png" /></p>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        You can see that the forecasted values are very close to the historical
        values, which is a good sign. The forecasted values are a little higher
        than the historical values, which is expected. Let's now look at the
        forecasted values for the 10 years following 2019.
      </p>
    </div>
    <div class="cell code" data-execution_count="226">
      <div class="sourceCode" id="cb45">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fc, key <span class="kw">in</span> [(fc_overall, <span class="st">&#39;overall&#39;</span>),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                (fc_male,    <span class="st">&#39;male&#39;</span>),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                (fc_female,  <span class="st">&#39;female&#39;</span>)]:</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> <span class="ss">f&#39;pred_</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    df_tmp <span class="op">=</span> fc.rename(columns<span class="op">=</span>{<span class="st">&#39;pred&#39;</span>: col})</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> forecast_df <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>        forecast_df <span class="op">=</span> df_tmp</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>        forecast_df <span class="op">=</span> forecast_df.merge(df_tmp, on<span class="op">=</span><span class="st">&#39;year&#39;</span>, how<span class="op">=</span><span class="st">&#39;outer&#39;</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>display(forecast_df.head(<span class="dv">11</span>))</span></code></pre>
      </div>
      <div class="output display_data">
        <div>
          <style scoped>
            .dataframe tbody tr th:only-of-type {
              vertical-align: middle;
            }

            .dataframe tbody tr th {
              vertical-align: top;
            }

            .dataframe thead th {
              text-align: right;
            }
          </style>
          <table border="1" class="dataframe">
            <thead>
              <tr style="text-align: right">
                <th></th>
                <th>year</th>
                <th>pred_overall</th>
                <th>pred_male</th>
                <th>pred_female</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>0</th>
                <td>2020</td>
                <td>246.700278</td>
                <td>239.066187</td>
                <td>267.355158</td>
              </tr>
              <tr>
                <th>1</th>
                <td>2021</td>
                <td>247.223248</td>
                <td>239.390388</td>
                <td>267.846358</td>
              </tr>
              <tr>
                <th>2</th>
                <td>2022</td>
                <td>247.746218</td>
                <td>239.714589</td>
                <td>268.337559</td>
              </tr>
              <tr>
                <th>3</th>
                <td>2023</td>
                <td>248.269189</td>
                <td>240.038790</td>
                <td>268.828760</td>
              </tr>
              <tr>
                <th>4</th>
                <td>2024</td>
                <td>248.792159</td>
                <td>240.362990</td>
                <td>269.319960</td>
              </tr>
              <tr>
                <th>...</th>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
              </tr>
              <tr>
                <th>6</th>
                <td>2026</td>
                <td>249.838100</td>
                <td>241.011392</td>
                <td>270.302362</td>
              </tr>
              <tr>
                <th>7</th>
                <td>2027</td>
                <td>250.361071</td>
                <td>241.335593</td>
                <td>270.793562</td>
              </tr>
              <tr>
                <th>8</th>
                <td>2028</td>
                <td>250.884041</td>
                <td>241.659793</td>
                <td>271.284763</td>
              </tr>
              <tr>
                <th>9</th>
                <td>2029</td>
                <td>251.407012</td>
                <td>241.983994</td>
                <td>271.775964</td>
              </tr>
              <tr>
                <th>10</th>
                <td>2030</td>
                <td>251.929982</td>
                <td>242.308195</td>
                <td>272.267164</td>
              </tr>
            </tbody>
          </table>
          <p>11 rows × 4 columns</p>
        </div>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        As you can see, the predicted values are slightly increasing over time,
        which is not what we initially expected. As running technology has
        improved, we would expect the average finish time to decrease over time.
        However, this is not the case.
      </p>
      <p>
        After further thought, we believe that the reason for this is the
        increase in popularity of the marathon. Since Berlin uses a lottery
        system as the main way to select participants, the times are not as
        competitive as a marathon like the Boston Marathon which requires a
        qualifying time.
      </p>
      <p>
        With more people wanting to run the marathon, the average finish time
        has increased.
      </p>
      <p>
        Now, let's look at the 5th percentile finish time. This captures the
        performance of the fastest runners, and therefore more useful for
        predicting the future of the elite runners.
      </p>
    </div>
    <div class="cell code" data-execution_count="227">
      <div class="sourceCode" id="cb46">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute 5th-percentile finish time per year</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>p5_overall <span class="op">=</span> (</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">&#39;year&#39;</span>, as_index<span class="op">=</span><span class="va">False</span>)[<span class="st">&#39;time_full_minutes&#39;</span>]</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    .quantile(<span class="fl">0.05</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">&#39;time_full_minutes&#39;</span>:<span class="st">&#39;time_5pct&#39;</span>})</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>p5_male <span class="op">=</span> (</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    df[df[<span class="st">&#39;gender_code&#39;</span>]<span class="op">==</span><span class="st">&#39;M&#39;</span>]</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">&#39;year&#39;</span>, as_index<span class="op">=</span><span class="va">False</span>)[<span class="st">&#39;time_full_minutes&#39;</span>]</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    .quantile(<span class="fl">0.05</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">&#39;time_full_minutes&#39;</span>:<span class="st">&#39;time_5pct&#39;</span>})</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>p5_female <span class="op">=</span> (</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    df[df[<span class="st">&#39;gender_code&#39;</span>]<span class="op">==</span><span class="st">&#39;W&#39;</span>]</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">&#39;year&#39;</span>, as_index<span class="op">=</span><span class="va">False</span>)[<span class="st">&#39;time_full_minutes&#39;</span>]</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    .quantile(<span class="fl">0.05</span>)</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">&#39;time_full_minutes&#39;</span>:<span class="st">&#39;time_5pct&#39;</span>})</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;5th Percentile Finish Time per Year&quot;</span>, p5_overall)</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;5th Percentile Finish Time per Year for Males&quot;</span>, p5_male)</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;5th Percentile Finish Time per Year for Females&quot;</span>, p5_female)</span></code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;5th Percentile Finish Time per Year&#39;</code></pre>
      </div>
      <div class="output display_data">
        <div>
          <style scoped>
            .dataframe tbody tr th:only-of-type {
              vertical-align: middle;
            }

            .dataframe tbody tr th {
              vertical-align: top;
            }

            .dataframe thead th {
              text-align: right;
            }
          </style>
          <table border="1" class="dataframe">
            <thead>
              <tr style="text-align: right">
                <th></th>
                <th>year</th>
                <th>time_5pct</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>0</th>
                <td>1999</td>
                <td>174.600000</td>
              </tr>
              <tr>
                <th>1</th>
                <td>2000</td>
                <td>178.503333</td>
              </tr>
              <tr>
                <th>2</th>
                <td>2001</td>
                <td>176.500000</td>
              </tr>
              <tr>
                <th>3</th>
                <td>2002</td>
                <td>172.883333</td>
              </tr>
              <tr>
                <th>4</th>
                <td>2004</td>
                <td>175.809167</td>
              </tr>
              <tr>
                <th>...</th>
                <td>...</td>
                <td>...</td>
              </tr>
              <tr>
                <th>15</th>
                <td>2015</td>
                <td>174.815833</td>
              </tr>
              <tr>
                <th>16</th>
                <td>2016</td>
                <td>175.596667</td>
              </tr>
              <tr>
                <th>17</th>
                <td>2017</td>
                <td>176.086667</td>
              </tr>
              <tr>
                <th>18</th>
                <td>2018</td>
                <td>176.410000</td>
              </tr>
              <tr>
                <th>19</th>
                <td>2019</td>
                <td>171.783333</td>
              </tr>
            </tbody>
          </table>
          <p>20 rows × 2 columns</p>
        </div>
      </div>
      <div class="output display_data">
        <pre><code>&#39;5th Percentile Finish Time per Year for Males&#39;</code></pre>
      </div>
      <div class="output display_data">
        <div>
          <style scoped>
            .dataframe tbody tr th:only-of-type {
              vertical-align: middle;
            }

            .dataframe tbody tr th {
              vertical-align: top;
            }

            .dataframe thead th {
              text-align: right;
            }
          </style>
          <table border="1" class="dataframe">
            <thead>
              <tr style="text-align: right">
                <th></th>
                <th>year</th>
                <th>time_5pct</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>0</th>
                <td>1999</td>
                <td>173.366667</td>
              </tr>
              <tr>
                <th>1</th>
                <td>2000</td>
                <td>177.485000</td>
              </tr>
              <tr>
                <th>2</th>
                <td>2001</td>
                <td>175.033333</td>
              </tr>
              <tr>
                <th>3</th>
                <td>2002</td>
                <td>171.716667</td>
              </tr>
              <tr>
                <th>4</th>
                <td>2004</td>
                <td>173.750000</td>
              </tr>
              <tr>
                <th>...</th>
                <td>...</td>
                <td>...</td>
              </tr>
              <tr>
                <th>15</th>
                <td>2015</td>
                <td>171.958333</td>
              </tr>
              <tr>
                <th>16</th>
                <td>2016</td>
                <td>172.193333</td>
              </tr>
              <tr>
                <th>17</th>
                <td>2017</td>
                <td>172.290833</td>
              </tr>
              <tr>
                <th>18</th>
                <td>2018</td>
                <td>172.530000</td>
              </tr>
              <tr>
                <th>19</th>
                <td>2019</td>
                <td>167.253333</td>
              </tr>
            </tbody>
          </table>
          <p>20 rows × 2 columns</p>
        </div>
      </div>
      <div class="output display_data">
        <pre><code>&#39;5th Percentile Finish Time per Year for Females&#39;</code></pre>
      </div>
      <div class="output display_data">
        <div>
          <style scoped>
            .dataframe tbody tr th:only-of-type {
              vertical-align: middle;
            }

            .dataframe tbody tr th {
              vertical-align: top;
            }

            .dataframe thead th {
              text-align: right;
            }
          </style>
          <table border="1" class="dataframe">
            <thead>
              <tr style="text-align: right">
                <th></th>
                <th>year</th>
                <th>time_5pct</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>0</th>
                <td>1999</td>
                <td>198.833333</td>
              </tr>
              <tr>
                <th>1</th>
                <td>2000</td>
                <td>204.840833</td>
              </tr>
              <tr>
                <th>2</th>
                <td>2001</td>
                <td>204.325000</td>
              </tr>
              <tr>
                <th>3</th>
                <td>2002</td>
                <td>196.910000</td>
              </tr>
              <tr>
                <th>4</th>
                <td>2004</td>
                <td>201.631667</td>
              </tr>
              <tr>
                <th>...</th>
                <td>...</td>
                <td>...</td>
              </tr>
              <tr>
                <th>15</th>
                <td>2015</td>
                <td>199.773333</td>
              </tr>
              <tr>
                <th>16</th>
                <td>2016</td>
                <td>201.045833</td>
              </tr>
              <tr>
                <th>17</th>
                <td>2017</td>
                <td>200.101667</td>
              </tr>
              <tr>
                <th>18</th>
                <td>2018</td>
                <td>199.150000</td>
              </tr>
              <tr>
                <th>19</th>
                <td>2019</td>
                <td>197.733333</td>
              </tr>
            </tbody>
          </table>
          <p>20 rows × 2 columns</p>
        </div>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        Now, we will fit a linear regression model to the 5th percentile finish
        time.
      </p>
    </div>
    <div class="cell code" data-execution_count="228">
      <div class="sourceCode" id="cb50">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to fit &amp; forecast</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_and_forecast(df, label, start<span class="op">=</span><span class="dv">2020</span>, end<span class="op">=</span><span class="dv">2050</span>):</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.DataFrame({<span class="st">&#39;year&#39;</span>:[], <span class="ss">f&#39;pred_</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">&#39;</span>:[]})</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> df[[<span class="st">&#39;year&#39;</span>]].values</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> df[<span class="st">&#39;time_5pct&#39;</span>].values</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> LinearRegression().fit(X, y)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    future <span class="op">=</span> np.arange(start, end<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> model.predict(future.reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({<span class="st">&#39;year&#39;</span>:future, <span class="ss">f&#39;pred_</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">&#39;</span>:preds})</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>fc_overall <span class="op">=</span> fit_and_forecast(p5_overall, <span class="st">&#39;overall&#39;</span>)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>fc_male    <span class="op">=</span> fit_and_forecast(p5_male,    <span class="st">&#39;male&#39;</span>)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>fc_female  <span class="op">=</span> fit_and_forecast(p5_female,  <span class="st">&#39;female&#39;</span>)</span></code></pre>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        We can now plot the fit and forecast for the 5th percentile finish time.
      </p>
    </div>
    <div class="cell code" data-execution_count="229">
      <div class="sourceCode" id="cb51">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot each on its own figure</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>series <span class="op">=</span> [</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;Overall 5th-</span><span class="sc">%i</span><span class="st">le&#39;</span>, p5_overall, fc_overall),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;Male 5th-</span><span class="sc">%i</span><span class="st">le&#39;</span>,    p5_male,    fc_male),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;Female 5th-</span><span class="sc">%i</span><span class="st">le&#39;</span>,  p5_female,  fc_female),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> title, hist, fc <span class="kw">in</span> series:</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    plt.plot(hist[<span class="st">&#39;year&#39;</span>], hist[<span class="st">&#39;time_5pct&#39;</span>],</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>             marker<span class="op">=</span><span class="st">&#39;o&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;-&#39;</span>, label<span class="op">=</span><span class="st">&#39;Historical&#39;</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> fc.empty:</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        plt.plot(fc[<span class="st">&#39;year&#39;</span>], fc[<span class="ss">f&#39;pred_</span><span class="sc">{</span>title<span class="sc">.</span>split()[<span class="dv">0</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&#39;</span>],</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>                 marker<span class="op">=</span><span class="st">&#39;x&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, label<span class="op">=</span><span class="st">&#39;Forecast&#39;</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f&quot;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss"> Finish Time&quot;</span>)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&quot;Year&quot;</span>)</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&quot;5th Percentile Finish Time (min)&quot;</span>)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre>
      </div>
      <div class="output display_data">
        <p><img src="images/b681e2072d2cd66792d4faf2c8334fe4046b8301.png" /></p>
      </div>
      <div class="output display_data">
        <p><img src="images/467355a720bf2a7e2ae0633312904d6f1c5e7ea2.png" /></p>
      </div>
      <div class="output display_data">
        <p><img src="images/5eb7afaa3bb3c3eda9e3b0fd3d82cb0f3c6be4cd.png" /></p>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        We can see that the forecasted values are now decreasing over time,
        which is what we initially expected.
      </p>
    </div>
    <div class="cell code" data-execution_count="230">
      <div class="sourceCode" id="cb52">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fc, key <span class="kw">in</span> [</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    (fc_overall, <span class="st">&#39;overall&#39;</span>),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    (fc_male,    <span class="st">&#39;male&#39;</span>),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    (fc_female,  <span class="st">&#39;female&#39;</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>]:</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> forecast_df <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>        forecast_df <span class="op">=</span> fc.copy()</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>        forecast_df <span class="op">=</span> forecast_df.merge(fc, on<span class="op">=</span><span class="st">&#39;year&#39;</span>, how<span class="op">=</span><span class="st">&#39;outer&#39;</span>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>display(forecast_df.head(<span class="dv">11</span>))</span></code></pre>
      </div>
      <div class="output display_data">
        <div>
          <style scoped>
            .dataframe tbody tr th:only-of-type {
              vertical-align: middle;
            }

            .dataframe tbody tr th {
              vertical-align: top;
            }

            .dataframe thead th {
              text-align: right;
            }
          </style>
          <table border="1" class="dataframe">
            <thead>
              <tr style="text-align: right">
                <th></th>
                <th>year</th>
                <th>pred_overall</th>
                <th>pred_male</th>
                <th>pred_female</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>0</th>
                <td>2020</td>
                <td>176.409344</td>
                <td>172.740013</td>
                <td>201.315839</td>
              </tr>
              <tr>
                <th>1</th>
                <td>2021</td>
                <td>176.341105</td>
                <td>172.542768</td>
                <td>201.175376</td>
              </tr>
              <tr>
                <th>2</th>
                <td>2022</td>
                <td>176.272866</td>
                <td>172.345522</td>
                <td>201.034913</td>
              </tr>
              <tr>
                <th>3</th>
                <td>2023</td>
                <td>176.204627</td>
                <td>172.148277</td>
                <td>200.894450</td>
              </tr>
              <tr>
                <th>4</th>
                <td>2024</td>
                <td>176.136389</td>
                <td>171.951031</td>
                <td>200.753987</td>
              </tr>
              <tr>
                <th>...</th>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
              </tr>
              <tr>
                <th>6</th>
                <td>2026</td>
                <td>175.999911</td>
                <td>171.556540</td>
                <td>200.473062</td>
              </tr>
              <tr>
                <th>7</th>
                <td>2027</td>
                <td>175.931672</td>
                <td>171.359294</td>
                <td>200.332599</td>
              </tr>
              <tr>
                <th>8</th>
                <td>2028</td>
                <td>175.863433</td>
                <td>171.162048</td>
                <td>200.192136</td>
              </tr>
              <tr>
                <th>9</th>
                <td>2029</td>
                <td>175.795194</td>
                <td>170.964803</td>
                <td>200.051673</td>
              </tr>
              <tr>
                <th>10</th>
                <td>2030</td>
                <td>175.726955</td>
                <td>170.767557</td>
                <td>199.911210</td>
              </tr>
            </tbody>
          </table>
          <p>11 rows × 4 columns</p>
        </div>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        The model predicts that the 5th percentile finish time will continue to
        decrease over time, which is what we initially expected. We found it
        most interesting that the model predicts that the 5th percentile of men
        could finish in just 2 hours and 10 minutes by 2030.
      </p>
      <p>
        Next, we will use a random forest model to predict the 5th percentile
        finish time by nationality. First, we have to set the parameters for the
        model.
      </p>
    </div>
    <div class="cell code" data-execution_count="231">
      <div class="sourceCode" id="cb53">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>SPLIT_COLS <span class="op">=</span> [</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;split_5k_minutes&#39;</span>, <span class="st">&#39;split_10k_minutes&#39;</span>, <span class="st">&#39;split_15k_minutes&#39;</span>,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;split_20k_minutes&#39;</span>, <span class="st">&#39;time_half_minutes&#39;</span>,  <span class="st">&#39;split_25k_minutes&#39;</span>,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;split_30k_minutes&#39;</span>, <span class="st">&#39;split_35k_minutes&#39;</span>, <span class="st">&#39;split_40k_minutes&#39;</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>]</span></code></pre>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        Now, let's compute the 5th percentile finish time by year and
        nationality. After that, we will compute the mean split times by year
        and nationality. Lastly, we will merge the two dataframes on the year
        and nationality columns.
      </p>
    </div>
    <div class="cell code" data-execution_count="232">
      <div class="sourceCode" id="cb54">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the 5th-percentile finish time by year &amp; nationality</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>df_p5 <span class="op">=</span> (</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    results</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">&#39;year&#39;</span>,<span class="st">&#39;nationality&#39;</span>], as_index<span class="op">=</span><span class="va">False</span>)[<span class="st">&#39;time_full_minutes&#39;</span>]</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    .quantile(<span class="fl">0.05</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">&#39;time_full_minutes&#39;</span>:<span class="st">&#39;time_5pct&#39;</span>})</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute mean split times by year &amp; nationality</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>mean_splits <span class="op">=</span> (</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    results</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">&#39;year&#39;</span>,<span class="st">&#39;nationality&#39;</span>], as_index<span class="op">=</span><span class="va">False</span>)[SPLIT_COLS]</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    .mean(numeric_only<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the two dataframes on the year and nationality columns</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.merge(df_p5, mean_splits, on<span class="op">=</span>[<span class="st">&#39;year&#39;</span>,<span class="st">&#39;nationality&#39;</span>], how<span class="op">=</span><span class="st">&#39;inner&#39;</span>)</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;5th Percentile Finish Time by Year and Nationality&quot;</span>, df_p5)</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Mean Split Times by Year and Nationality&quot;</span>, mean_splits)</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Merged Dataframe&quot;</span>, df)</span></code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;5th Percentile Finish Time by Year and Nationality&#39;</code></pre>
      </div>
      <div class="output display_data">
        <div>
          <style scoped>
            .dataframe tbody tr th:only-of-type {
              vertical-align: middle;
            }

            .dataframe tbody tr th {
              vertical-align: top;
            }

            .dataframe thead th {
              text-align: right;
            }
          </style>
          <table border="1" class="dataframe">
            <thead>
              <tr style="text-align: right">
                <th></th>
                <th>year</th>
                <th>nationality</th>
                <th>time_5pct</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>0</th>
                <td>1999</td>
                <td>ALG</td>
                <td>197.746667</td>
              </tr>
              <tr>
                <th>1</th>
                <td>1999</td>
                <td>ARG</td>
                <td>181.234167</td>
              </tr>
              <tr>
                <th>2</th>
                <td>1999</td>
                <td>AUS</td>
                <td>176.785000</td>
              </tr>
              <tr>
                <th>3</th>
                <td>1999</td>
                <td>AUT</td>
                <td>168.150000</td>
              </tr>
              <tr>
                <th>4</th>
                <td>1999</td>
                <td>BEL</td>
                <td>144.116667</td>
              </tr>
              <tr>
                <th>...</th>
                <td>...</td>
                <td>...</td>
                <td>...</td>
              </tr>
              <tr>
                <th>1613</th>
                <td>2019</td>
                <td>VIE</td>
                <td>202.687500</td>
              </tr>
              <tr>
                <th>1614</th>
                <td>2019</td>
                <td>WLS</td>
                <td>238.513333</td>
              </tr>
              <tr>
                <th>1615</th>
                <td>2019</td>
                <td>YEM</td>
                <td>291.883333</td>
              </tr>
              <tr>
                <th>1616</th>
                <td>2019</td>
                <td>ZAM</td>
                <td>153.538333</td>
              </tr>
              <tr>
                <th>1617</th>
                <td>2019</td>
                <td>ZIM</td>
                <td>289.350000</td>
              </tr>
            </tbody>
          </table>
          <p>1618 rows × 3 columns</p>
        </div>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Mean Split Times by Year and Nationality&#39;</code></pre>
      </div>
      <div class="output display_data">
        <div>
          <style scoped>
            .dataframe tbody tr th:only-of-type {
              vertical-align: middle;
            }

            .dataframe tbody tr th {
              vertical-align: top;
            }

            .dataframe thead th {
              text-align: right;
            }
          </style>
          <table border="1" class="dataframe">
            <thead>
              <tr style="text-align: right">
                <th></th>
                <th>year</th>
                <th>nationality</th>
                <th>split_5k_minutes</th>
                <th>split_10k_minutes</th>
                <th>split_15k_minutes</th>
                <th>split_20k_minutes</th>
                <th>time_half_minutes</th>
                <th>split_25k_minutes</th>
                <th>split_30k_minutes</th>
                <th>split_35k_minutes</th>
                <th>split_40k_minutes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>0</th>
                <td>1999</td>
                <td>ALG</td>
                <td>27.458333</td>
                <td>53.725000</td>
                <td>34.233333</td>
                <td>103.650000</td>
                <td>109.441667</td>
                <td>128.716667</td>
                <td>155.941667</td>
                <td>180.675000</td>
                <td>205.825000</td>
              </tr>
              <tr>
                <th>1</th>
                <td>1999</td>
                <td>ARG</td>
                <td>0.000000</td>
                <td>41.858333</td>
                <td>62.775000</td>
                <td>83.908333</td>
                <td>88.675000</td>
                <td>105.308333</td>
                <td>128.008333</td>
                <td>151.566667</td>
                <td>176.675000</td>
              </tr>
              <tr>
                <th>2</th>
                <td>1999</td>
                <td>AUS</td>
                <td>22.180952</td>
                <td>50.952381</td>
                <td>75.569048</td>
                <td>99.783333</td>
                <td>105.314286</td>
                <td>124.195238</td>
                <td>150.426190</td>
                <td>177.683333</td>
                <td>206.145238</td>
              </tr>
              <tr>
                <th>3</th>
                <td>1999</td>
                <td>AUT</td>
                <td>16.486777</td>
                <td>50.064738</td>
                <td>72.923691</td>
                <td>98.985399</td>
                <td>104.813912</td>
                <td>124.610055</td>
                <td>151.518113</td>
                <td>176.200895</td>
                <td>207.681612</td>
              </tr>
              <tr>
                <th>4</th>
                <td>1999</td>
                <td>BEL</td>
                <td>17.378836</td>
                <td>47.292328</td>
                <td>69.284392</td>
                <td>93.743386</td>
                <td>97.434921</td>
                <td>117.550794</td>
                <td>142.859524</td>
                <td>168.600529</td>
                <td>194.963492</td>
              </tr>
              <tr>
                <th>...</th>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
              </tr>
              <tr>
                <th>1613</th>
                <td>2019</td>
                <td>VIE</td>
                <td>24.350000</td>
                <td>48.100000</td>
                <td>72.316667</td>
                <td>95.541667</td>
                <td>100.666667</td>
                <td>119.141667</td>
                <td>142.841667</td>
                <td>166.483333</td>
                <td>192.325000</td>
              </tr>
              <tr>
                <th>1614</th>
                <td>2019</td>
                <td>WLS</td>
                <td>28.333333</td>
                <td>56.900000</td>
                <td>85.755556</td>
                <td>114.477778</td>
                <td>120.655556</td>
                <td>143.761111</td>
                <td>173.461111</td>
                <td>202.966667</td>
                <td>233.827778</td>
              </tr>
              <tr>
                <th>1615</th>
                <td>2019</td>
                <td>YEM</td>
                <td>31.583333</td>
                <td>64.800000</td>
                <td>98.333333</td>
                <td>132.183333</td>
                <td>139.583333</td>
                <td>167.016667</td>
                <td>202.716667</td>
                <td>240.600000</td>
                <td>276.733333</td>
              </tr>
              <tr>
                <th>1616</th>
                <td>2019</td>
                <td>ZAM</td>
                <td>25.283333</td>
                <td>50.983333</td>
                <td>77.038889</td>
                <td>102.533333</td>
                <td>108.111111</td>
                <td>128.777778</td>
                <td>155.600000</td>
                <td>182.977778</td>
                <td>212.466667</td>
              </tr>
              <tr>
                <th>1617</th>
                <td>2019</td>
                <td>ZIM</td>
                <td>31.766667</td>
                <td>62.866667</td>
                <td>94.200000</td>
                <td>125.516667</td>
                <td>132.316667</td>
                <td>157.166667</td>
                <td>189.900000</td>
                <td>226.216667</td>
                <td>269.466667</td>
              </tr>
            </tbody>
          </table>
          <p>1618 rows × 11 columns</p>
        </div>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Merged Dataframe&#39;</code></pre>
      </div>
      <div class="output display_data">
        <div>
          <style scoped>
            .dataframe tbody tr th:only-of-type {
              vertical-align: middle;
            }

            .dataframe tbody tr th {
              vertical-align: top;
            }

            .dataframe thead th {
              text-align: right;
            }
          </style>
          <table border="1" class="dataframe">
            <thead>
              <tr style="text-align: right">
                <th></th>
                <th>year</th>
                <th>nationality</th>
                <th>time_5pct</th>
                <th>split_5k_minutes</th>
                <th>split_10k_minutes</th>
                <th>split_15k_minutes</th>
                <th>split_20k_minutes</th>
                <th>time_half_minutes</th>
                <th>split_25k_minutes</th>
                <th>split_30k_minutes</th>
                <th>split_35k_minutes</th>
                <th>split_40k_minutes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>0</th>
                <td>1999</td>
                <td>ALG</td>
                <td>197.746667</td>
                <td>27.458333</td>
                <td>53.725000</td>
                <td>34.233333</td>
                <td>103.650000</td>
                <td>109.441667</td>
                <td>128.716667</td>
                <td>155.941667</td>
                <td>180.675000</td>
                <td>205.825000</td>
              </tr>
              <tr>
                <th>1</th>
                <td>1999</td>
                <td>ARG</td>
                <td>181.234167</td>
                <td>0.000000</td>
                <td>41.858333</td>
                <td>62.775000</td>
                <td>83.908333</td>
                <td>88.675000</td>
                <td>105.308333</td>
                <td>128.008333</td>
                <td>151.566667</td>
                <td>176.675000</td>
              </tr>
              <tr>
                <th>2</th>
                <td>1999</td>
                <td>AUS</td>
                <td>176.785000</td>
                <td>22.180952</td>
                <td>50.952381</td>
                <td>75.569048</td>
                <td>99.783333</td>
                <td>105.314286</td>
                <td>124.195238</td>
                <td>150.426190</td>
                <td>177.683333</td>
                <td>206.145238</td>
              </tr>
              <tr>
                <th>3</th>
                <td>1999</td>
                <td>AUT</td>
                <td>168.150000</td>
                <td>16.486777</td>
                <td>50.064738</td>
                <td>72.923691</td>
                <td>98.985399</td>
                <td>104.813912</td>
                <td>124.610055</td>
                <td>151.518113</td>
                <td>176.200895</td>
                <td>207.681612</td>
              </tr>
              <tr>
                <th>4</th>
                <td>1999</td>
                <td>BEL</td>
                <td>144.116667</td>
                <td>17.378836</td>
                <td>47.292328</td>
                <td>69.284392</td>
                <td>93.743386</td>
                <td>97.434921</td>
                <td>117.550794</td>
                <td>142.859524</td>
                <td>168.600529</td>
                <td>194.963492</td>
              </tr>
              <tr>
                <th>...</th>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
              </tr>
              <tr>
                <th>1613</th>
                <td>2019</td>
                <td>VIE</td>
                <td>202.687500</td>
                <td>24.350000</td>
                <td>48.100000</td>
                <td>72.316667</td>
                <td>95.541667</td>
                <td>100.666667</td>
                <td>119.141667</td>
                <td>142.841667</td>
                <td>166.483333</td>
                <td>192.325000</td>
              </tr>
              <tr>
                <th>1614</th>
                <td>2019</td>
                <td>WLS</td>
                <td>238.513333</td>
                <td>28.333333</td>
                <td>56.900000</td>
                <td>85.755556</td>
                <td>114.477778</td>
                <td>120.655556</td>
                <td>143.761111</td>
                <td>173.461111</td>
                <td>202.966667</td>
                <td>233.827778</td>
              </tr>
              <tr>
                <th>1615</th>
                <td>2019</td>
                <td>YEM</td>
                <td>291.883333</td>
                <td>31.583333</td>
                <td>64.800000</td>
                <td>98.333333</td>
                <td>132.183333</td>
                <td>139.583333</td>
                <td>167.016667</td>
                <td>202.716667</td>
                <td>240.600000</td>
                <td>276.733333</td>
              </tr>
              <tr>
                <th>1616</th>
                <td>2019</td>
                <td>ZAM</td>
                <td>153.538333</td>
                <td>25.283333</td>
                <td>50.983333</td>
                <td>77.038889</td>
                <td>102.533333</td>
                <td>108.111111</td>
                <td>128.777778</td>
                <td>155.600000</td>
                <td>182.977778</td>
                <td>212.466667</td>
              </tr>
              <tr>
                <th>1617</th>
                <td>2019</td>
                <td>ZIM</td>
                <td>289.350000</td>
                <td>31.766667</td>
                <td>62.866667</td>
                <td>94.200000</td>
                <td>125.516667</td>
                <td>132.316667</td>
                <td>157.166667</td>
                <td>189.900000</td>
                <td>226.216667</td>
                <td>269.466667</td>
              </tr>
            </tbody>
          </table>
          <p>1618 rows × 12 columns</p>
        </div>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        We've decided to restrict the data to the 20 fastest nationalities by
        average 5th percentile finish time.
      </p>
    </div>
    <div class="cell code" data-execution_count="233">
      <div class="sourceCode" id="cb58">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>top20 <span class="op">=</span> (</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    df.groupby(<span class="st">&#39;nationality&#39;</span>)[<span class="st">&#39;time_5pct&#39;</span>]</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>      .mean()</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>      .nsmallest(<span class="dv">20</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>      .index</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">&#39;nationality&#39;</span>].isin(top20)].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code></pre>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        To continue, we will one-hot encode the nationality column. This is
        because the random forest model requires categorical data to be encoded.
      </p>
    </div>
    <div class="cell code" data-execution_count="234">
      <div class="sourceCode" id="cb59">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>nat_dummies <span class="op">=</span> pd.get_dummies(df[<span class="st">&#39;nationality&#39;</span>], prefix<span class="op">=</span><span class="st">&#39;nat&#39;</span>, drop_first<span class="op">=</span><span class="va">True</span>)</span></code></pre>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        Since our data is already split into training and test sets, we can
        directly build the feature matrix and target vector. We can then train
        the model on the training set and evaluate it on the test set.
      </p>
    </div>
    <div class="cell code" data-execution_count="235">
      <div class="sourceCode" id="cb60">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build feature matrix X and target y</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.concat([ df[[<span class="st">&#39;year&#39;</span>]], nat_dummies, df[SPLIT_COLS] ], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">&#39;time_5pct&#39;</span>]</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Train/test split (keep test indices for plotting)</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test, idx_train, idx_test <span class="op">=</span> train_test_split(</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    X, y, df.index, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre>
      </div>
    </div>
    <div class="cell markdown">
      <p>We can now perform hyperparameter tuning via RandomizedSearchCV.</p>
    </div>
    <div class="cell code" data-execution_count="236">
      <div class="sourceCode" id="cb61">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hyperparameter tuning via RandomizedSearchCV</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>param_dist <span class="op">=</span> {</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;n_estimators&#39;</span>:    [<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">500</span>],</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;max_depth&#39;</span>:       [<span class="va">None</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>],</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;min_samples_leaf&#39;</span>:[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>],</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;max_features&#39;</span>:    [<span class="st">&#39;sqrt&#39;</span>, <span class="st">&#39;log2&#39;</span>, <span class="fl">0.5</span>]</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>rf_base <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>search <span class="op">=</span> RandomizedSearchCV(</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    rf_base,</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    param_dist,</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    n_iter<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    scoring<span class="op">=</span><span class="st">&#39;r2&#39;</span>,</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>search.fit(X_train, y_train)</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>display(<span class="st">&quot;Best hyperparameters:&quot;</span>, search.best_params_)</span></code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Best hyperparameters:&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>{&#39;n_estimators&#39;: 500,
 &#39;min_samples_leaf&#39;: 1,
 &#39;max_features&#39;: 0.5,
 &#39;max_depth&#39;: 5}</code></pre>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        We can now train the model on the training set and evaluate it on the
        test set.
      </p>
    </div>
    <div class="cell code" data-execution_count="237">
      <div class="sourceCode" id="cb64">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit final model with best params</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>rf_final <span class="op">=</span> RandomForestRegressor(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">**</span>search.best_params_, </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>rf_final.fit(X_train, y_train)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on the test set</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> rf_final.predict(X_test)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>r2  <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;Final MSE: </span><span class="sc">{</span>mse<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>display(<span class="ss">f&quot;Final R² : </span><span class="sc">{</span>r2<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span></code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Final MSE: 113.53&#39;</code></pre>
      </div>
      <div class="output display_data">
        <pre><code>&#39;Final R² : 0.671&#39;</code></pre>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        We can see that the model had a final MSE of 113.53 (sqrt(113.53) =
        10.66 is small relative to the 120-200 range of the 5th percentile
        finish time) and an R² of 0.671. Even though the model is not perfect,
        it is still a good model.
      </p>
      <p>
        Now, we can plot the actual vs predicted 5th percentile finish time by
        nationality.
      </p>
    </div>
    <div class="cell code" data-execution_count="238">
      <div class="sourceCode" id="cb67">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare DataFrame for plotting colored by nationality</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>df_vis <span class="op">=</span> pd.DataFrame({</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;actual&#39;</span>:      y_test,</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;predicted&#39;</span>:   y_pred,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;nationality&#39;</span>: df.loc[idx_test, <span class="st">&#39;nationality&#39;</span>]</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Actual vs Predicted</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> nat, grp <span class="kw">in</span> df_vis.groupby(<span class="st">&#39;nationality&#39;</span>):</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    plt.scatter(grp[<span class="st">&#39;actual&#39;</span>], grp[<span class="st">&#39;predicted&#39;</span>], alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span>nat)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>mn, mx <span class="op">=</span> df_vis[[<span class="st">&#39;actual&#39;</span>,<span class="st">&#39;predicted&#39;</span>]].<span class="bu">min</span>().<span class="bu">min</span>(), df_vis[[<span class="st">&#39;actual&#39;</span>,<span class="st">&#39;predicted&#39;</span>]].<span class="bu">max</span>().<span class="bu">max</span>()</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>plt.plot([mn, mx], [mn, mx], <span class="st">&#39;k--&#39;</span>, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Actual 5th-Percentile Time (min)&quot;</span>)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Predicted 5th-Percentile Time (min)&quot;</span>)</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;RandomForest Predictions by Nationality (Top 20)&quot;</span>)</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>,<span class="dv">1</span>), loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>)</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre>
      </div>
      <div class="output display_data">
        <p><img src="images/ef3b299b6fb9ceb4540ebece986ada0db6b76e0e.png" /></p>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        The graph has some interesting outliers, but overall, the model is able
        to predict the 5th percentile finish time by nationality fairly well.
        Nations with traditionally strong depth (notably Kenya, Ethiopia, etc.)
        tend to show faster mid-race splits and the model nails their 5th
        percentile finish time more precisely. Smaller, less developed nations
        like Zimbabwe and Guam show slower mid-race splits and a higher spread
        in predicted 5th percentile finish times but the forest still captures
        the general trend.
      </p>
      <p>Lastly, we can plot the top 20 feature importances.</p>
    </div>
    <div class="cell code" data-execution_count="239">
      <div class="sourceCode" id="cb68">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Top 20 Feature Importances</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> pd.Series(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    rf_final.feature_importances_,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>X.columns</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>).nlargest(<span class="dv">20</span>).sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">8</span>))</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>importances.plot(kind<span class="op">=</span><span class="st">&#39;barh&#39;</span>)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Top 20 Feature Importances&quot;</span>)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Importance&quot;</span>)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre>
      </div>
      <div class="output display_data">
        <p><img src="images/77d5f9affa59a0f316d4295a6e58388c860cf6f4.png" /></p>
      </div>
    </div>
    <div class="cell markdown">
      <p>
        The top predictors are the mid-to late-race splits, especially the 25km
        and 10km marks and half-marathon time. This tells us that how a national
        cohort performs is highly dependent on how they perform in the second
        half of the race. Year is also a strong predictor, which is expected.
        Nationality dummies are also within the top 20, meaning that once we
        have accounted for split performance, simply being from a certain
        country can have a relative impact on performance.
      </p>
      <p>
        The fact that splits dominate over nationality suggests that in-race
        pacing data is the best predictor for how deep the field will be, much
        more so than the nationality of the runners.
      </p>
    </div>
    <section id="6-insights-and-conclusions" class="cell markdown">
      <h2>6. Insights and Conclusions</h2>
      <p>
        Our analysis of the Berlin Marathon data from 1999 to 2019 has revealed
        several key insights:
      </p>
      <ol>
        <li>
          <p>
            There is a statistically significant gender difference in marathon
            performance. Males finish the marathon notably faster than females,
            with a mean time of 3.92 hours for males compared to 4.38 hours for
            females — a gap of 27.33 minutes. The difference is reinforced by
            similar disparities in the medians. A t-statistic of -146.88 and an
            extremely low p-value (&lt; 0.0001) confirm that this result is
            highly statistically significant and unlikely due to random
            variation.
          </p>
        </li>
        <li>
          <p>
            Runners tend to slow down over the course of the marathon. Analysis
            of the 5k split paces from 1999 to 2019 shows a clear trend:
            participants start the race at a faster pace and gradually slow down
            in the later segments. This pacing pattern is typical in
            long-distance running, where early energy and adrenaline lead to
            quicker initial splits, followed by a steady decline in speed as
            fatigue sets in. The box plot of paces across the race confirms this
            slowdown, with later splits showing slower and more variable times.
            This trend highlights the physical and mental challenges of
            maintaining a consistent pace throughout the marathon.
          </p>
        </li>
        <li>
          <p>
            The 5th percentile finish time is a more accurate representation of
            the performance of the fastest runners, and therefore more useful
            for predicting the future. The split times are a better predictor of
            performance than the nationality of the runners.
          </p>
        </li>
      </ol>
      <h3 id="limitations-and-future-work">Limitations and Future Work</h3>
      <p>
        While our analysis provides valuable insights, there are some
        limitations to consider:
      </p>
      <ol>
        <li>
          <p>
            The lack of individual context or conditions. The dataset does not
            account for personal factors such as age, injuries, training
            history, weather conditions on race day, or pacing strategies, all
            of which can significantly impact performance and pace changes.
          </p>
        </li>
        <li>
          <p>
            The dataset focuses on the Berlin Marathon only, which may not fully
            represent broader trends across other marathons or regions. Results
            might vary significantly in different locations or under different
            race conditions.
          </p>
        </li>
        <li>
          <p>
            The dataset does not account for the fact that the Berlin Marathon
            is a lottery race, which means that the runners are not all the
            same. This is why we see such a large disparity in the performance
            of the runners from different countries.
          </p>
        </li>
      </ol>
      <p>Future work could address these limitations by:</p>
      <ol>
        <li>
          <p>
            Future analyses could include personal factors such as age, health
            status, training regimes, and specific race day conditions to better
            understand their impact on performance and pacing patterns.
          </p>
        </li>
        <li>
          <p>
            By analyzing marathon data from multiple locations and years, it
            would be possible to compare trends across different environments,
            and analyze how similar running patterns are across multiple races
            and whether outside factors such as location have a significant
            impact.
          </p>
        </li>
      </ol>
      <h3 id="references">References</h3>
      <ol>
        <li>
          You can learn more about the Berlin Marathon
          <a href="https://en.wikipedia.org/wiki/Berlin_Marathon">here</a>.
        </li>
      </ol>
    </section>
  </body>
</html>
